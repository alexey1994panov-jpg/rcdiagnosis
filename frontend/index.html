<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>RC Diagnosis MVP</title>
    <link rel="stylesheet" href="static/style.css">
    <style>
        /* РЎС‚РёР»Рё РґР»СЏ С‚Р°Р±РѕРІ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #ccc;
            margin-bottom: 20px;
            gap: 5px;
            flex-wrap: wrap;
        }
        .tab-button {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-bottom: none;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        .tab-button:hover {
            background: #e0e0e0;
        }
        .tab-button.active {
            background: white;
            border-bottom: 2px solid white;
            margin-bottom: -2px;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            min-height: 300px;
        }
        .tab-content.active {
            display: block;
        }
        .loading {
            color: #999;
            font-style: italic;
        }
        /* Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅРѕ РґР»СЏ РІС‹РґРµР»РµРЅРёСЏ СЃС‚СЂРѕРєРё С‚Р°Р№РјР»Р°Р№РЅР° */
        .timeline-selected {
            background-color: #ffeeba;
        }
        .timebar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        .timebar button {
            padding: 2px 8px;
        }
        #timebarcontainer {
            display: flex;
            width: 100%;
            height: 16px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .timebar-segment {
            height: 100%;
            background-color: #ddd;
        }
        .timebar-segment-lz {
            background-color: #f99;
        }
    </style>
</head>
<body>
    <h1>RC Diagnosis MVP</h1>

        <!-- Табы навигации -->
    <div class="tabs">
        <button class="tab-button active" data-tab="tab-lz-exc">ЛЗ</button>
        <button class="tab-button" data-tab="tab-ls-exc">ЛС</button>
        <button class="tab-button" data-tab="tab-exc-config">Исключения JSON</button>
        <button class="tab-button" data-tab="tab-simulation">Симуляция</button>
    </div>

    <!-- Контейнеры табов -->
    <div id="tab-lz-exc" class="tab-content active">
        <div class="loading">Загрузка ЛЗ + исключений...</div>
    </div>

    <div id="tab-ls-exc" class="tab-content">
        <div class="loading">Загрузка ЛС + исключений...</div>
    </div>

    <div id="tab-exc-config" class="tab-content">
        <div class="loading">Загрузка конфигурации исключений...</div>
    </div>

    <!-- Таб: Симуляция (сценарий + результаты) -->
    <div id="tab-simulation" class="tab-content">
        <h2>Сценарий</h2>
        <p><b>Участок:</b> динамически определяется по данным станции и сценарию.</p>
        <div id="scenario-column-controls" class="controls"></div>
        <table id="scenariotable" class="scenario-table">
            <thead><tr><th>Loading...</th></tr></thead>
            <tbody></tbody>
        </table>

        <div class="controls">
            <button type="button" id="addsteprow">Добавить строку</button>
            <button type="button" id="repeatprevrow">Повторить предыдущую</button>
            <button type="button" id="applyscenariotable">Применить таблицу → JSON</button>
        </div>

        <h2>Сценарий JSON</h2>
        <p>JSON представление сценария:</p>
        <textarea id="scenariotext"></textarea>
        <div class="controls">
            <button type="button" onclick="runSimulation()">Запустить симуляцию</button>
        </div>

        <!-- Управление тестами -->
        <div class="scenario-block">
            <h3>Управление тестами</h3>
            <div class="controls">
                <select id="testsselect" style="min-width: 260px;"></select>
                <button type="button" onclick="loadSelectedTest()">Загрузить тест</button>
                <button type="button" onclick="saveCurrentAsTest()">Сохранить как тест</button>
                <button type="button" onclick="markTestStatus('ok')">✓ OK</button>
                <button type="button" onclick="markTestStatus('fail')">✗ FAIL</button>
                <button type="button" onclick="deleteSelectedTest()">Удалить тест</button>
            </div>
            <div class="controls">
                <span id="testinfo"></span>
            </div>
        </div>

        <!-- Результаты симуляции -->
        <div style="margin-top: 40px; border-top: 2px solid #333; padding-top: 20px;">
            <h2>Результаты симуляции</h2>
            <div class="track-scheme">
                <svg id="track-svg" width="1700" height="620"></svg>
            </div>
            <div id="timeline-column-controls" class="controls"></div>

            <!-- Таймбар -->
            <div class="timebar">
                <button type="button" onclick="moveSelectionRelative(-1)">◀</button>
                <span id="timebarinfo"></span>
                <button type="button" onclick="moveSelectionRelative(1)">▶</button>
            </div>
            <div id="timebarcontainer"></div>

            <!-- Таблица результатов -->
            <div style="max-height: 640px; overflow-y: auto; border: 1px solid #ccc;">
                <table id="timelinetable">
                    <thead><tr><th>Loading...</th></tr></thead>
                    <tbody id="timeline-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- РњРѕРґСѓР»Рё -->
    <script type="module" src="static/timeline-flags.js?v=20260212r"></script>
    <script type="module" src="static/timeline-scheme.js?v=20260212r"></script>
    <script type="module" src="static/timeline-render.js?v=20260212r"></script>
    <script type="module" src="static/timeline.js?v=20260212r"></script>

    <script src="static/tabs.js?v=20260212r"></script>
    <script src="static/options.js?v=20260212r"></script>
    <script src="static/scenario.js?v=20260212r"></script>
    <script src="static/exceptions-config.js?v=20260212r"></script>
    <script src="static/tests.js?v=20260212r"></script>
    <script src="static/app.js?v=20260212r"></script>

    <script>
        function moveSelectionRelative(delta) {
            if (window.moveSelectionRelativeImpl) {
                window.moveSelectionRelativeImpl(delta);
            }
        }
    </script>
</body>
</html>
