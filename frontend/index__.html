<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>RC Diagnosis MVP</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>

<h1>RC Diagnosis MVP</h1>

<div class="scenario-block">
  <h3>Настройки логики</h3>

  <!-- ЛЗ: варианты 1,2,3,8 -->
  <div class="scenario-block">
    <h4>Логическая занятость (ЛЗ)</h4>

    <table class="logic-table">
      <tr>
        <td class="logic-col">
          <table class="logic-variant logic-variant-v1">
            <tr><th colspan="2">ЛЗ v1</th></tr>
            <tr>
              <td>T_S0101 (0‑0‑0)</td>
              <td><input id="t_s0101" type="number" value="15" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LZ01 (0‑1‑0)</td>
              <td><input id="t_lz01" type="number" value="5" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_v1 (свободность)</td>
              <td><input id="t_kon_v1" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_v1 (пауза)</td>
              <td><input id="t_pause_v1" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 1 ЛЗ</td>
              <td><input id="enable_v1" type="checkbox" checked></td>
            </tr>
          </table>
        </td>

        <td class="logic-col">
          <table class="logic-variant logic-variant-v2">
            <tr><th colspan="2">ЛЗ v2</th></tr>
            <tr>
              <td>T_S0102 (фаза 1)</td>
              <td><input id="t_s0102" type="number" value="5" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0202 (фаза 2)</td>
              <td><input id="t_s0202" type="number" value="15" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LZ02 (хвост)</td>
              <td><input id="t_lz02" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_v2 (свободность)</td>
              <td><input id="t_kon_v2" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_v2 (пауза)</td>
              <td><input id="t_pause_v2" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 2 ЛЗ</td>
              <td><input id="enable_v2" type="checkbox" checked></td>
            </tr>
          </table>
        </td>

        <td class="logic-col">
          <table class="logic-variant logic-variant-v3">
            <tr><th colspan="2">ЛЗ v3</th></tr>
            <tr>
              <td>T_S0103 (фаза 1)</td>
              <td><input id="t_s0103" type="number" value="5" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0203 (фаза 2)</td>
              <td><input id="t_s0203" type="number" value="15" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LZ03 (хвост)</td>
              <td><input id="t_lz03" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_v3 (свободность)</td>
              <td><input id="t_kon_v3" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_v3 (пауза)</td>
              <td><input id="t_pause_v3" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 3 ЛЗ</td>
              <td><input id="enable_v3" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
      </tr>

      <td class="logic-col">
          <table class="logic-variant logic-variant-v6">
            <tr><th colspan="2">ЛЗ v6 </th></tr>
            <tr>
              <td>T_S06 (свободность до ЛЗ)</td>
              <td><input id="t_s06" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LZ06 (занятость для ЛЗ)</td>
              <td><input id="t_lz06" type="number" value="600" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_v6 (свободность для завершения)</td>
              <td><input id="t_kon_v6" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 6 ЛЗ</td>
              <td><input id="enable_v6" type="checkbox" checked></td>
            </tr>
          </table>
        </td>

        <tr>
        <td class="logic-col">
          <table class="logic-variant logic-variant-v8">
            <tr><th colspan="2">ЛЗ v8</th></tr>
            <tr>
              <td>T_S0108 (событие 01)</td>
              <td><input id="t_s0108" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0208 (событие 02)</td>
              <td><input id="t_s0208" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LZ08 (хвост)</td>
              <td><input id="t_lz08" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_v8 (свободность)</td>
              <td><input id="t_kon_v8" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_v8 (пауза)</td>
              <td><input id="t_pause_v8" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 8 ЛЗ</td>
              <td><input id="enable_v8" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
          

      

        <td class="logic-col"></td>
        <td class="logic-col"></td>
      </tr>
    </table>
  </div>
  <div class="scenario-block">
    <h4>ЛЗ продвинутые (v10, v11, v12, v13)</h4>
    <table class="logic-table">
        <tr>
            <td class="logic-col">
                <table class="logic-variant logic-variant-v10">
                    <tr><th colspan="2">ЛЗ v10</th></tr>
                    <tr><td>Тс0110</td><td><input id="ts0110" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тс0210</td><td><input id="ts0210" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тс0310</td><td><input id="ts0310" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тлз10</td><td><input id="tlz10" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Ткон v10</td><td><input id="tkonv10" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тпауза v10</td><td><input id="tpausev10" type="number" value="0" step="0.1"></td></tr>
                    <tr><td>Включить v10</td><td><input id="enablev10" type="checkbox"></td></tr>
                </table>
            </td>
            <td class="logic-col">
                <table class="logic-variant logic-variant-v11">
                    <tr><th colspan="2">ЛЗ v11</th></tr>
                    <tr><td>Тс11</td><td><input id="ts11" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тлз11</td><td><input id="tlz11" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Ткон v11</td><td><input id="tkonv11" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тпауза v11</td><td><input id="tpausev11" type="number" value="0" step="0.1"></td></tr>
                    <tr><td>Включить v11</td><td><input id="enablev11" type="checkbox"></td></tr>
                </table>
            </td>
            <td class="logic-col">
                <table class="logic-variant logic-variant-v12">
                    <tr><th colspan="2">ЛЗ v12</th></tr>
                    <tr><td>Тс0112</td><td><input id="ts0112" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тс0212</td><td><input id="ts0212" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тлз12</td><td><input id="tlz12" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Ткон v12</td><td><input id="tkonv12" type="number" value="3" step="0.1"></td></tr>
                    <tr><td>Тпауза v12</td><td><input id="tpausev12" type="number" value="0" step="0.1"></td></tr>
                    <tr><td>Включить v12</td><td><input id="enablev12" type="checkbox"></td></tr>
                </table>
            </td>
        </tr>
        <tr>
            <td class="logic-col">
                <table class="logic-variant logic-variant-v13">
                    <tr><th colspan="2">ЛЗ v13</th></tr>
                    <tr><td>Тс0113</td><td><input id="ts0113" type="number" value="10" step="0.1"></td></tr>
                    <tr><td>Тс0213</td><td><input id="ts0213" type="number" value="10" step="0.1"></td></tr>
                    <tr><td>Тлз13</td><td><input id="tlz13" type="number" value="10" step="0.1"></td></tr>
                    <tr><td>Ткон v13</td><td><input id="tkonv13" type="number" value="10" step="0.1"></td></tr>
                    <tr><td>Тпауза v13</td><td><input id="tpausev13" type="number" value="0" step="0.1"></td></tr>
                    <tr><td>Включить v13</td><td><input id="enablev13" type="checkbox"></td></tr>
                    <tr><td>Контр. РЦ v13</td><td>
                        <select id="v13ctrlrcid">
                            <option value="10-12SP">10-12SP</option>
                            <option value="1-7SP">1-7SP</option>
                        </select>
                    </td></tr>
                </table>
            </td>
            <td class="logic-col"></td>
            <td class="logic-col"></td>
        </tr>
    </table>
</div>

  <!-- ЛС: варианты 1,2,4,9 -->
  <div class="scenario-block">
    <h4>Логическая ложная свободность (ЛС)</h4>

    <table class="logic-table">
      <tr>
        <td class="logic-col">
          <table class="logic-variant logic-variant-ls1">
            <tr><th colspan="2">ЛС v1</th></tr>
            <tr>
              <td>T_C0101_LS (событие 01)</td>
              <td><input id="t_c0101_ls" type="number" value="20" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS01 (хвост)</td>
              <td><input id="t_ls01" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_LS1 (занятость для завершения)</td>
              <td><input id="t_kon_ls1" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_LS1 (пауза после ЛС1)</td>
              <td><input id="t_pause_ls1" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 1 ЛС</td>
              <td><input id="enable_ls1" type="checkbox" checked></td>
            </tr>
          </table>
        </td>

        <td class="logic-col">
          <table class="logic-variant logic-variant-ls2">
            <tr><th colspan="2">ЛС v2</th></tr>
            <tr>
              <td>T_S0102_LS (фаза 1)</td>
              <td><input id="t_s0102_ls" type="number" value="5" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0202_LS (фаза 3)</td>
              <td><input id="t_s0202_ls" type="number" value="15" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0102 (минимум хвоста)</td>
              <td><input id="t_ls0102" type="number" value="2" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0202 (максимум хвоста)</td>
              <td><input id="t_ls0202" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_LS2 (занятость для завершения)</td>
              <td><input id="t_kon_ls2" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_LS2 (пауза после ЛС2)</td>
              <td><input id="t_pause_ls2" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 2 ЛС</td>
              <td><input id="enable_ls2" type="checkbox" checked></td>
            </tr>
          </table>
        </td>

        <td class="logic-col">
          <table class="logic-variant logic-variant-ls4">
            <tr><th colspan="2">ЛС v4</th></tr>
            <tr>
              <td>T_S0104_LS (событие 01)</td>
              <td><input id="t_s0104_ls" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0204_LS (событие 02)</td>
              <td><input id="t_s0204_ls" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0104 (минимум хвоста)</td>
              <td><input id="t_ls0104" type="number" value="16" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0204 (максимум хвоста)</td>
              <td><input id="t_ls0204" type="number" value="60" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_LS4 (занятость для завершения)</td>
              <td><input id="t_kon_ls4" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_LS4 (пауза после ЛС4)</td>
              <td><input id="t_pause_ls4" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 4 ЛС</td>
              <td><input id="enable_ls4" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
      </tr>

      <!-- ЛС v9 -->
      <tr>
        <td class="logic-col">
          <table class="logic-variant logic-variant-ls9">
            <tr><th colspan="2">ЛС v9</th></tr>
            <tr>
              <td>T_S0109_LS (занятость до мигания)</td>
              <td><input id="t_s0109_ls" type="number" value="2" step="0.1"></td>
            </tr>
            <tr>
              <td>T_S0209_LS (занятость после мигания)</td>
              <td><input id="t_s0209_ls" type="number" value="2" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0109 (мин. хвост свободности)</td>
              <td><input id="t_ls0109" type="number" value="2" step="0.1"></td>
            </tr>
            <tr>
              <td>T_LS0209 (макс. хвост свободности)</td>
              <td><input id="t_ls0209" type="number" value="10" step="0.1"></td>
            </tr>
            <tr>
              <td>T_KON_LS9 (занятость для завершения)</td>
              <td><input id="t_kon_ls9" type="number" value="3" step="0.1"></td>
            </tr>
            <tr>
              <td>T_pause_LS9 (пауза после ЛС9)</td>
              <td><input id="t_pause_ls9" type="number" value="0" step="0.1"></td>
            </tr>
            <tr>
              <td>Включить вариант 9 ЛС</td>
              <td><input id="enable_ls9" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
        <td class="logic-col"></td>
        <td class="logic-col"></td>
      </tr>
    </table>
  </div>

  <!-- Исключения ЛЗ -->
  <div class="scenario-block">
    <h4>Исключения ЛЗ</h4>
    <table class="logic-table">
      <tr>
        <td class="logic-col">
          <table class="logic-variant">
            <tr><th colspan="2">Local MU / Recent LS / DSP</th></tr>
            <tr>
              <td>T_MU (окно МУ, сек)</td>
              <td><input id="t_mu" type="number" value="15" step="1"></td>
            </tr>
            <tr>
              <td>T_RECENT_LS (ЛС на смежных, сек)</td>
              <td><input id="t_recent_ls" type="number" value="12" step="1"></td>
            </tr>
            <tr>
              <td>T_MIN_MANEUVER_V8 (манёвр v8, сек)</td>
              <td><input id="t_min_maneuver_v8" type="number" value="600" step="1"></td>
            </tr>
            <tr>
              <td>Учитывать местное управление (ЛЗ)</td>
              <td><input id="enable_lz_exc_mu" type="checkbox" checked></td>
            </tr>
            <tr>
              <td>Учитывать недавнюю ЛС на смежных (ЛЗ)</td>
              <td><input id="enable_lz_exc_recent_ls" type="checkbox" checked></td>
            </tr>
            <tr>
              <td>Учитывать ДСП-исключение (ЛЗ v8)</td>
              <td><input id="enable_lz_exc_dsp" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>

    <!-- Исключения ЛС -->
  <div class="scenario-block">
    <h4>Исключения ЛС</h4>
    <table class="logic-table">
      <tr>
        <td class="logic-col">
          <table class="logic-variant">
            <tr><th colspan="2">LS Exceptions</th></tr>

            <!-- тайминги исключений ЛС -->
            <tr>
              <td>T_LS_MU (окно МУ для ЛС, сек)</td>
              <td><input id="t_ls_mu" type="number" value="15" step="1"></td>
            </tr>
            <tr>
              <td>T_LS_AFTER_LZ (ЛЗ до ЛС, сек)</td>
              <td><input id="t_ls_after_lz" type="number" value="30" step="1"></td>
            </tr>
            <tr>
              <td>T_LS_DSP (манёвр ДСП для ЛС, сек)</td>
              <td><input id="t_ls_dsp" type="number" value="600" step="1"></td>
            </tr>

            <!-- флаги включения/выключения исключений ЛС -->
            <tr>
              <td>Учитывать местное управление (ЛС)</td>
              <td><input id="enable_ls_exc_mu" type="checkbox" checked></td>
            </tr>
            <tr>
              <td>Не формировать ЛС, если была ЛЗ</td>
              <td><input id="enable_ls_exc_after_lz" type="checkbox" checked></td>
            </tr>
            <tr>
              <td>Учитывать ДСП-исключение (ЛС)</td>
              <td><input id="enable_ls_exc_dsp" type="checkbox" checked></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </div>


  <h2>Сценарий (табличный ввод)</h2>

  <p>
    <b>Участок:</b> 10-12SP (<b>Sw10</b>) — 1P — 1-7SP (стрелки <b>Sw1</b>, <b>Sw5</b>).
  </p>

  <table id="scenario_table" class="scenario-table">
    <thead>
      <tr>
        <th>Δt, c</th>
        <th>10-12SP</th>
        <th>1P</th>
        <th>1-7SP</th>
        <th>Sw10</th>
        <th>Sw1</th>
        <th>Sw5</th>
        <th>MU 10-12SP</th>
        <th>MU 1P</th>
        <th>MU 1-7SP</th>
        <th>DSP</th>
        <th>NAS</th>
        <th>CHAS</th>
      </tr>
    </thead>
    <tbody>
      <!-- строки добавляет JS -->
    </tbody>
  </table>

  <div class="controls">
    <button type="button" id="add_step_row">Добавить шаг</button>
    <button type="button" id="repeat_prev_row">Повторить предыдущий шаг</button>
    <button type="button" id="deletesteprow">Удалить выбранную</button>
    <button type="button" id="apply_scenario_table">Применить таблицу к JSON</button>
  </div>

  <h2>Сценарий (JSON)</h2>

  <p>Текущий JSON‑сценарий:</p>
  <textarea id="scenario_text"></textarea>
</div>

<div class="controls">
  <button type="button" onclick="runSimulation()">Выполнить симуляцию</button>
</div>

<!-- Блок сохранённых тестов -->
<div class="scenario-block">
  <h3>Сохранённые тесты</h3>
  <div class="controls">
    <select id="tests_select" style="min-width: 260px;"></select>
    <button type="button" onclick="loadSelectedTest()">Загрузить</button>
    <button type="button" onclick="saveCurrentAsTest()">Сохранить текущий как тест</button>
    <button type="button" onclick="markTestStatus('ok')">Отметить как OK</button>
    <button type="button" onclick="markTestStatus('fail')">Отметить как FAIL</button>
  </div>
  <div class="controls">
    <span id="test_info"></span>
  </div>
</div>

<h2>Результат таймлайна</h2>

<!-- Индикаторы местного управления и автодействий -->
<div class="controls">
  <span id="mu_indicator_prev" class="mu-indicator">МУ 10-12SP</span>
  <span id="mu_indicator_curr" class="mu-indicator">МУ 1P</span>
  <span id="mu_indicator_next" class="mu-indicator">МУ 1-7SP</span>
  <span id="nas_indicator" class="aa-indicator">АС NAS</span>
  <span id="chas_indicator" class="aa-indicator">АС CHAS</span>
</div>

<!-- Схема участка -->
<div class="track-scheme" id="track_scheme">
  <div class="rc-block" id="rc_prev_block">
    <div><b>10-12SP</b></div>
    <div id="rc_prev_state_lbl">—</div>
    <div class="sw-row">
      <span id="sw10_label">Sw10:</span>
      <span id="sw10_state_lbl">—</span>
    </div>
  </div>
  →
  <div class="rc-block" id="rc_curr_block">
    <div><b>1P</b></div>
    <div id="rc_curr_state_lbl">—</div>
  </div>
  →
  <div class="rc-block" id="rc_next_block">
    <div><b>1-7SP</b></div>
    <div id="rc_next_state_lbl">—</div>
    <div class="sw-row">
      <span id="sw1_label">Sw1:</span>
      <span id="sw1_state_lbl">—</span>,
      <span id="sw5_label">Sw5:</span>
      <span id="sw5_state_lbl">—</span>
    </div>
  </div>
</div>

<!-- Лента времени -->
<div class="timebar">
  <button type="button" onclick="moveSelection(-1)">«</button>
  <span id="timebar_info">Шаг: —</span>
  <button type="button" onclick="moveSelection(1)">»</button>
  <div id="timebar_container"></div>
</div>

<div style="max-height: 320px; overflow-y: auto; border: 1px solid #ccc;">
  <table id="timeline_table">
    <thead>
      <tr>
        <th>Δt, c</th>
        <th>LZ</th>
        <th>Вариант ЛЗ</th>
        <th>10-12SP</th>
        <th>Сост. 10-12SP</th>
        <th>Sw10</th>
        <th>1P</th>
        <th>Сост. 1P</th>
        <th>1-7SP</th>
        <th>Сост. 1-7SP</th>
        <th>Sw1</th>
        <th>Sw5</th>
        <th>MU 10-12SP</th>
        <th>MU 1P</th>
        <th>MU 1-7SP</th>
        <th>DSP</th>
        <th>NAS</th>
        <th>CHAS</th>
        <th>Flags</th>
        <th>Описание флагов</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script src="/static/app.js"></script>
</body>
</html>
