# Варианты ЛЗ (`tools/variants/lz`)

## Назначение
Папка содержит реализации детекторов ЛЗ (логическая ложная занятость) по вариантам.
Используются три шаблона реализации:
- `BaseDetector` для линейной цепочки фаз
- `BaseVariantWrapper` для ветвящихся вариантов
- специализированный детектор (`TimingDetectorLZ9`) для событийного окна времени

## Общие требования реализации
1. Проверки состояния РЦ должны идти через унифицированные предикаты (`rc_is_free`, `rc_is_occupied`, `rc_is_locked`).
2. Топология должна использовать соседей текущего шага (`effective_prev_rc`, `effective_next_rc`), а не только статические связи.
3. Открытие ДС должно происходить только при достижении финальной фазы (`next_phase_id = -1`).
4. Закрытие ДС должно использовать `completion_mode` и `t_kon`.
5. Исключения применяются после шага детектора, в постобработке симуляции.

## Требования по вариантам

### LZ1 (`variant1_lz_factory.py`)
1. Фазы: `000` в течение `ts01_lz1`, затем `010` в течение `tlz_lz1`.
2. Завершение: `FREE_TIME`, `tkon_lz1`.
3. Соседи: обязательны оба (`BOTH`).

### LZ2 (`variant2_lz_factory.py`)
1. Две независимые ветки: `prev` и `next`.
2. Ветка `prev`: `100 -> 110 -> (100|000)`.
3. Ветка `next`: `001 -> 011 -> (001|000)`.
4. Завершение: `FREE_TIME`, `tkon_lz2`.

### LZ3 (`variant3_lz_factory.py`)
1. Фазы: `101 -> 111 -> 101`.
2. Тайминги: `ts01_lz3`, `tlz_lz3`, `ts02_lz3`.
3. Завершение: `FREE_TIME`, `tkon_lz3`.
4. Соседи: оба соседа должны быть валидными.

### LZ4 (`variant4_lz_factory.py`)
1. Две NC-ветки (`PrevNC`, `NextNC`) с проверкой закрытого сигнала.
2. Паттерн ветки: `ctrl free + NC(side) + signal closed`, затем `ctrl occupied + NC(side) + signal closed`.
3. Завершение: `FREE_TIME`, `tkon_lz4`.
4. Требование к соседям: `ONE_NC`.

### LZ5 (`variant5_lz_factory.py`)
1. Фазы: `ctrl free + not locked (+can_lock)`, затем `ctrl occupied + not locked (+can_lock)`.
2. Требование к соседям: `ONLY_CTRL`.
3. Завершение: `FREE_TIME`, `tkon_lz5`.

### LZ6 (`variant6_lz_factory.py`)
1. Одноцепочечный control-only детектор.
2. Фазы: `ctrl free`, затем `ctrl occupied`.
3. Требование к соседям: `ONLY_CTRL`.
4. Завершение: `FREE_TIME`, `tkon_lz6`.

### LZ7 (`variant7_lz_factory.py`)
1. Ветвящийся детектор без обязательных соседей (краевые случаи топологии).
2. Базовые маски используют x-паттерны с переходом в занятость.
3. Требование к соседям: `NONE`.
4. Завершение: `FREE_TIME`, `tkon_lz7`.

### LZ8 (`variant8_lz_factory.py`)
1. Три ветки (ориентация на `prev`, на `next`, и средняя).
2. Цепочки фаз зависят от сигналов и соседей.
3. Завершение: `FREE_TIME`, `tkon_lz8`.
4. Требование к соседям: `BOTH`.

### LZ9 (`variant_lz9_lz_factory.py`)
1. Специализированный тайминговый детектор, не `BaseDetector`.
2. Использует дельту времени между занятием контролируемой и смежной РЦ.
3. Открывает ДС, когда дельта попадает в окно `tlz_lz9`.
4. Завершение: `FREE_TIME`, `tkon_lz9`.

### LZ10 (`variant_lz10_lz_factory.py`)
1. Многофазный сигналозависимый детектор с направленными ветками.
2. Использует `ts01_lz10`, `ts02_lz10`, `ts03_lz10`, `tlz_lz10`.
3. Проверяет настроенные сигналы направления.
4. Завершение: `FREE_TIME`, `tkon_lz10`.

### LZ11 (`variant_lz11_lz_factory.py`)
1. Сигналозависимый детектор с двумя проверками закрытого сигнала.
2. Фаза 1: control free + оба сигнала закрыты.
3. Фаза 2: control occupied + оба сигнала закрыты.
4. Завершение: `FREE_TIME`, `tkon_lz11`.

### LZ12 (`variant_lz12_lz_factory.py`)
1. NC-зависимый ветвящийся детектор по стороне смежной РЦ.
2. Ветка выбирается по тому, какая смежная сторона NC.
3. Завершение: `FREE_TIME`, `tkon_lz12`.
4. Требование к соседям: `ONE_NC`.

### LZ13 (`variant_lz13_lz_factory.py`)
1. Детектор по смежной РЦ с зависимостью от сигнала.
2. Базовая цепочка: phase01 (`adj free`) -> phase02 (`adj occupied + ctrl free`) -> kogda (`adj occupied + ctrl occupied`).
3. Завершение: `FREE_TIME`, `tkon_lz13`.
4. Требование к соседям: `ONE_ADJ`.
